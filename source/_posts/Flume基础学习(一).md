---
title: FlumeåŸºç¡€å­¦ä¹ ï¼ˆä¸€ï¼‰
thumbnail: 'https://s2.loli.net/2024/10/28/Nz39OC2F7swuYIB.jpg'
cover: 'https://s2.loli.net/2024/10/28/Nz39OC2F7swuYIB.jpg'
description: >-
  ä¹‹å‰ä»…ä»…åœ¨æ¯•ä¸šè®¾è®¡ä¸­ç”¨åˆ°äº†è¿™ä¸ªå·¥å…·ï¼Œåšä¸ºæ•°æ®åˆ†æçš„è¡Œä¸ºæ—¥å¿—é‡‡é›†å·¥å…·ï¼Œåˆ°ç›®å‰ä¸ºæ­¢åœ¨å·¥ä½œä¸­ä¹Ÿæ²¡æœ‰ä½¿ç”¨åˆ°å’Œæ¶‰åŠåˆ°ã€‚å½“æ—¶åœ¨ä½¿ç”¨è¿™ä¸ªå·¥å…·æ—¶ï¼Œå­¦ä¹ çš„å†…å®¹çš„æ·±åº¦ç›¸å¯¹æ¥è¯´ä¹Ÿæ¯”è¾ƒæµ…è–„ã€‚åç»­ä¼šæ ¹æ®å­¦ä¹ å†…å®¹å’Œè§„åˆ’åšç›¸åº”çš„è°ƒæ•´ï¼Œå®Œå–„ç›¸å…³çš„å­¦ä¹ ç¬”è®°ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Flumeå·¥å…·çš„åŸºæœ¬é…ç½®ä½¿ç”¨ã€å„ä¸ªç»„ä»¶åœ¨å…¶ä¸­å‘æŒ¥çš„ä½œç”¨ã€å†…éƒ¨æ¶æ„ç­‰ã€‚
categories:
  - å¤§æ•°æ®
  - æ•°æ®é‡‡é›†
tags:
  - å·¥å…·
  - Flume
  - æ•°æ®é‡‡é›†
  - åˆ†å¸ƒå¼
abbrlink: 1e46a8be
---

# FlumeåŸºç¡€å­¦ä¹ ï¼ˆä¸€ï¼‰

# ğŸ””ç¢ç¢å¿µï¼š

â€‹		ä¹‹å‰ä»…ä»…åœ¨æ¯•ä¸šè®¾è®¡ä¸­ç”¨åˆ°äº†è¿™ä¸ªå·¥å…·ï¼Œåšä¸ºæ•°æ®åˆ†æçš„è¡Œä¸ºæ—¥å¿—é‡‡é›†å·¥å…·ï¼Œåˆ°ç›®å‰ä¸ºæ­¢åœ¨å·¥ä½œä¸­ä¹Ÿæ²¡æœ‰ä½¿ç”¨åˆ°å’Œæ¶‰åŠåˆ°ã€‚å½“æ—¶åœ¨ä½¿ç”¨è¿™ä¸ªå·¥å…·æ—¶ï¼Œå­¦ä¹ çš„å†…å®¹çš„æ·±åº¦ç›¸å¯¹æ¥è¯´ä¹Ÿæ¯”è¾ƒæµ…è–„ã€‚åç»­ä¼šæ ¹æ®å­¦ä¹ å†…å®¹å’Œè§„åˆ’åšç›¸åº”çš„è°ƒæ•´ï¼Œå®Œå–„ç›¸å…³çš„å­¦ä¹ ç¬”è®°ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Flumeå·¥å…·çš„åŸºæœ¬é…ç½®ä½¿ç”¨ã€å„ä¸ªç»„ä»¶åœ¨å…¶ä¸­å‘æŒ¥çš„ä½œç”¨ã€å†…éƒ¨æ¶æ„ç­‰ã€‚

## ä¸€ã€Flumeæ¦‚è¿°ï¼š

### 1ã€å®šä¹‰ï¼š

Flumeæ˜¯Clouderaæä¾›çš„ä¸€ä¸ªé«˜å¯ç”¨çš„ï¼Œé«˜å¯é çš„ï¼Œåˆ†å¸ƒå¼çš„æµ·é‡æ—¥å¿—é‡‡é›†ã€èšåˆå’Œä¼ è¾“çš„ç³»ç»Ÿã€‚FlumeåŸºäºæµå¼æ¶æ„ï¼Œçµæ´»ç®€å•ã€‚

### 2ã€Flumeæ¶æ„

<img src="https://s2.loli.net/2024/10/28/nSDZrgUNuvHshA7.jpg" style="zoom:150%;" />

- agentï¼š

  - Agentæ˜¯ä¸€ä¸ªJVMè¿›ç¨‹ï¼Œå®ƒä»¥äº‹ä»¶çš„å½¢å¼å°†æ•°æ®ä»æºå¤´é€è‡³ç›®çš„ã€‚
  - Agentä¸»è¦æœ‰3ä¸ªéƒ¨åˆ†ç»„æˆï¼ŒSourceã€Channelã€Sinkã€‚

- source

  Sourceæ˜¯è´Ÿè´£æ¥æ”¶æ•°æ®åˆ°Flume Agentçš„ç»„ä»¶ã€‚Sourceç»„ä»¶å¯ä»¥å¤„ç†å„ç§ç±»å‹ã€å„ç§æ ¼å¼çš„æ—¥å¿—æ•°æ®ï¼ŒåŒ…æ‹¬**avro**ã€thriftã€**exec**ã€jmsã€**spooling directory**ã€**netcat**ã€ **taildir** ã€sequence generatorã€syslogã€httpã€legacyã€‚

- sink

  - Sinkä¸æ–­åœ°è½®è¯¢Channelä¸­çš„äº‹ä»¶ä¸”æ‰¹é‡åœ°ç§»é™¤å®ƒä»¬ï¼Œå¹¶å°†è¿™äº›äº‹ä»¶æ‰¹é‡å†™å…¥åˆ°å­˜å‚¨æˆ–ç´¢å¼•ç³»ç»Ÿã€æˆ–è€…è¢«å‘é€åˆ°å¦ä¸€ä¸ªFlume Agentã€‚
  - Sinkç»„ä»¶ç›®çš„åœ°åŒ…æ‹¬**hdfs**ã€**logger**ã€**avro**ã€thriftã€ipcã€**file**ã€**HBase**ã€solrã€è‡ªå®šä¹‰ã€‚

- channel

  - Channelæ˜¯ä½äºSourceå’ŒSinkä¹‹é—´çš„ç¼“å†²åŒºã€‚å› æ­¤ï¼ŒChannelå…è®¸Sourceå’ŒSinkè¿ä½œåœ¨ä¸åŒçš„é€Ÿç‡ä¸Šã€‚Channelæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥åŒæ—¶å¤„ç†å‡ ä¸ªSourceçš„å†™å…¥æ“ä½œå’Œå‡ ä¸ªSinkçš„è¯»å–æ“ä½œã€‚
  - Flumeè‡ªå¸¦ä¸¤ç§Channelï¼šMemory Channelå’ŒFile Channelã€‚
  - Memory Channelæ˜¯å†…å­˜ä¸­çš„é˜Ÿåˆ—ã€‚Memory Channelåœ¨ä¸éœ€è¦å…³å¿ƒæ•°æ®ä¸¢å¤±çš„æƒ…æ™¯ä¸‹é€‚ç”¨ã€‚å¦‚æœéœ€è¦å…³å¿ƒæ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆMemory Channelå°±ä¸åº”è¯¥ä½¿ç”¨ï¼Œå› ä¸ºç¨‹åºæ­»äº¡ã€æœºå™¨å®•æœºæˆ–è€…é‡å¯éƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚
  - File Channelå°†æ‰€æœ‰äº‹ä»¶å†™åˆ°ç£ç›˜ã€‚å› æ­¤åœ¨ç¨‹åºå…³é—­æˆ–æœºå™¨å®•æœºçš„æƒ…å†µä¸‹ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚

- event

  ä¼ è¾“å•å…ƒï¼ŒFlumeæ•°æ®ä¼ è¾“çš„åŸºæœ¬å•å…ƒï¼Œä»¥Eventçš„å½¢å¼å°†æ•°æ®ä»æºå¤´é€è‡³ç›®çš„åœ°ã€‚Eventç”±**Header**å’Œ**Body**ä¸¤éƒ¨åˆ†ç»„æˆï¼ŒHeaderç”¨æ¥å­˜æ”¾è¯¥eventçš„ä¸€äº›å±æ€§ï¼Œä¸ºK-Vç»“æ„ï¼ŒBodyç”¨æ¥å­˜æ”¾è¯¥æ¡æ•°æ®ï¼Œå½¢å¼ä¸ºå­—èŠ‚æ•°ç»„ã€‚

  | header(k,v) | body(byte array) |
  | ----------- | ---------------- |

## äºŒã€Flumeå…¥é—¨

### 1ã€å®‰è£…Flumeåœ°å€

- å®˜ç½‘åœ°å€ï¼šhttp://flume.apache.org/
- æ–‡æ¡£åœ°å€ï¼šhttp://flume.apache.org/FlumeUserGuide.html

### 2ã€å®‰è£…éƒ¨ç½²

hadoopç‰ˆæœ¬3.xè¦åˆ é™¤libæ–‡ä»¶å¤¹ä¸‹çš„guava-11.0.2.jaråŒ…ä»¥å…¼å®¹Hadoop 3.x

### 3ã€å®˜æ–¹å…¥é—¨æ¡ˆä¾‹

1. éœ€æ±‚ï¼šä½¿ç”¨Flumeç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œæ”¶é›†è¯¥ç«¯å£æ•°æ®ï¼Œå¹¶æ‰“å°åˆ°æ§åˆ¶å°ã€‚

2. å®‰è£…netcatå·¥å…·

   ~~~shell
   sudo yun install -y nc
   ~~~

1. åˆ›å»ºFlume Agenté…ç½®æ–‡ä»¶flume-netcat-logger.conf

   ~~~
   æ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š
   # Name the components on this agent    #a1è¡¨ç¤ºagentçš„åå­—
   a1.sources = r1  ##r1è¡¨ç¤ºa1 agentä¸€ä¸ªsourceçš„åå­—
   a1.sinks = k1    ##k1è¡¨ç¤ºa1 agentä¸€ä¸ªsinkçš„åå­—
   a1.channels = c1 ##c1è¡¨ç¤ºa1 agentä¸€ä¸ªchannelçš„åå­—
   
   # Describe/configure the source
   a1.sources.r1.type = netcat   ##è¡¨ç¤ºr1 sourceçš„ç±»å‹ä¹Ÿå°±æ˜¯è¾“å…¥æºçš„ç±»å‹
   a1.sources.r1.bind = localhost  ##è¦ç›‘å¬çš„ä¸»æœºçš„IP 
   a1.sources.r1.port = 44444  ###è¦ç›‘å¬çš„ç«¯å£å·æ˜¯å¤šå°‘
   
   # Describe the sink
   a1.sinks.k1.type = logger   ##a1çš„æ•°æ®è¾“å‡ºçš„ç›®çš„åœ°æ˜¯æ§åˆ¶å°
   
   # Use a channel which buffers events in memory
   a1.channels.c1.type = memory   ##è¡¨ç¤ºa1 channelçš„ç±»å‹æ˜¯memoryå†…å­˜å‹
   a1.channels.c1.capacity = 1000 ##è¡¨ç¤ºa1 channelçš„äº‹ä»¶å®¹é‡æ˜¯1000æ¡
   a1.channels.c1.transactionCapacity = 100  ##è¡¨ç¤ºa1çš„channelæ”¶é›†åˆ°100æ¡eventåå†å»æäº¤äº‹åŠ¡
   
   # Bind the source and sink to the channel
   a1.sources.r1.channels = c1   ##è¡¨ç¤ºå§r1å’Œc1è¿æ¥èµ·æ¥
   a1.sinks.k1.channel = c1      ##è¡¨ç¤ºæŠŠk1å’Œc1è¿æ¥èµ·æ¥
   ~~~

2. å¯åŠ¨flume

   ~~~
   bin/flume-ng agent --conf conf/ --name a1 --conf-file job/flume-netcat-logger.conf -Dflume.root.logger=INFO,console
   ~~~

   ```
    bin/flume-ng agent -c conf/ -n a1 -f job/flume-netcat-logger.conf -Dflume.root.logger=INFO,console
   ```

   å‚æ•°è¯´æ˜ï¼š

   â€‹    --conf/-cï¼šè¡¨ç¤ºé…ç½®æ–‡ä»¶å­˜å‚¨åœ¨conf/ç›®å½•

   â€‹    --name/-nï¼šè¡¨ç¤ºç»™agentèµ·åä¸ºa1

   â€‹    --conf-file/-fï¼šflumeæœ¬æ¬¡å¯åŠ¨è¯»å–çš„é…ç½®æ–‡ä»¶æ˜¯åœ¨jobæ–‡ä»¶å¤¹ä¸‹çš„flume-telnet.confæ–‡ä»¶ã€‚

   â€‹    -Dflume.root.logger=INFO,console ï¼š-Dè¡¨ç¤ºflumeè¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹flume.root.loggerå‚æ•°å±æ€§å€¼ï¼Œå¹¶å°†æ§åˆ¶å°æ—¥å¿—æ‰“å°çº§åˆ«è®¾ç½®ä¸ºINFOçº§åˆ«ã€‚æ—¥å¿—çº§åˆ«åŒ…æ‹¬:logã€infoã€warnã€errorã€‚

**#å®æ—¶ç›‘æ§å•ä¸ªè¿½åŠ æ–‡ä»¶æ¡ˆä¾‹**ã€‚

1. éœ€æ±‚è¯´æ˜ï¼šå®æ—¶ç›‘æ§Hiveæ—¥å¿—ï¼Œå¹¶ä¸Šä¼ åˆ°HDFSä¸­

2. é…ç½®æ–‡ä»¶ç¼–å†™ï¼š

   ~~~
   ##è‡ªå·±ç¼–å†™çš„é…ç½®
   a1.sources = r1
   a1.channels = c1
   a1.sinks=k1
   
   a1.sources.r1.type = TAILDIR
   a1.sources.r1.positionFile =/home/hdfs/flume/taildir_position.json
   a1.sources.r1.filegroups = f1
   a1.sources.r1.filegroups.f1 = /home/hdfs/flume/data/.*\.txt
   
   a1.sinks.k1.type=hdfs
   a1.sinks.k1.hdfs.path = hdfs://master:8020/flume/events/%Y-%m-%d/%H%M/%S
   a1.sinks.k1.hdfs.filePrefix = events-
   a1.sinks.k1.hdfs.round = true
   a1.sinks.k1.hdfs.roundValue = 10
   a1.sinks.k1.hdfs.roundUnit = minute
   a1.sinks.k1.hdfs.useLocalTimeStamp=true
   
   
   a1.channels.c1.type = memory
   a1.channels.c1.capacity = 10000
   a1.channels.c1.transactionCapacity = 100
   
   a1.sinks.k1.channel = c1
   a1.sources.r1.channels = c1
   
   #####################################################################################################
   #####################################################################################################
   #æ¡ˆä¾‹
   # Name the components on this agent
   a2.sources = r2
   a2.sinks = k2
   a2.channels = c2
   
   # Describe/configure the source
   a2.sources.r2.type = exec
   a2.sources.r2.command = tail -F /opt/module/hive/logs/hive.log
   
   # Describe the sink
   a2.sinks.k2.type = hdfs
   a2.sinks.k2.hdfs.path = hdfs://master:8020/flume/%Y%m%d/%H
   #ä¸Šä¼ æ–‡ä»¶çš„å‰ç¼€
   a2.sinks.k2.hdfs.filePrefix = logs-
   #æ˜¯å¦æŒ‰ç…§æ—¶é—´æ»šåŠ¨æ–‡ä»¶å¤¹
   a2.sinks.k2.hdfs.round = true
   #å¤šå°‘æ—¶é—´å•ä½åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹
   a2.sinks.k2.hdfs.roundValue = 1
   #é‡æ–°å®šä¹‰æ—¶é—´å•ä½
   a2.sinks.k2.hdfs.roundUnit = hour
   #æ˜¯å¦ä½¿ç”¨æœ¬åœ°æ—¶é—´æˆ³
   a2.sinks.k2.hdfs.useLocalTimeStamp = true
   #ç§¯æ”’å¤šå°‘ä¸ªEventæ‰flushåˆ°HDFSä¸€æ¬¡
   a2.sinks.k2.hdfs.batchSize = 100
   #è®¾ç½®æ–‡ä»¶ç±»å‹ï¼Œå¯æ”¯æŒå‹ç¼©
   a2.sinks.k2.hdfs.fileType = DataStream
   #å¤šä¹…ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶
   a2.sinks.k2.hdfs.rollInterval = 60
   #è®¾ç½®æ¯ä¸ªæ–‡ä»¶çš„æ»šåŠ¨å¤§å°
   a2.sinks.k2.hdfs.rollSize = 134217700
   #æ–‡ä»¶çš„æ»šåŠ¨ä¸Eventæ•°é‡æ— å…³
   a2.sinks.k2.hdfs.rollCount = 0
   
   # Use a channel which buffers events in memory
   a2.channels.c2.type = memory
   a2.channels.c2.capacity = 1000
   a2.channels.c2.transactionCapacity = 100
   
   # Bind the source and sink to the channel
   a2.sources.r2.channels = c2
   a2.sinks.k2.channel = c2
   
   ##########################################################################################################################################################################################################
   #æ¡ˆä¾‹ï¼š
   2. å…¥é—¨æ¡ˆä¾‹ 2.1  å®æ—¶ç›‘æ§å•ä¸ªè¿½åŠ æ–‡ä»¶,å°†å†…å®¹æ‰“å°åˆ°æ§åˆ¶å°
   é…ç½®æ–‡ä»¶åå­—: exec-flume-logger.conf
   ##name
   a1.sources = r1
   a1.channels = c1
   a1.sinks = k1
   
   ##source
   a1.sources.r1.type = exec
   a1.sources.r1.command = tail -F /home/hdfs/test/data.txt
   
   ##channel
   a1.channels.c1.type = memory
   a1.channels.c1.capacity = 10000
   a1.channels.c1.transactionCapacity = 100
   
   ###sink
   a1.sinks.k1.type = logger
   
   ##bind
   a1.sources.r1.channels = c1
   a1.sinks.k1.channel = c1 
   ~~~

**ï¼ƒå®æ—¶ç›‘æ§ç›®å½•ä¸‹å¤šä¸ªæ–°æ–‡ä»¶**

1. æ¡ˆä¾‹éœ€æ±‚ï¼šä½¿ç”¨Flumeç›‘å¬æ•´ä¸ªç›®å½•çš„æ–‡ä»¶ï¼Œå¹¶ä¸Šä¼ è‡³HDFS

2. é…ç½®æ–‡ä»¶ç¼–å†™

   ~~~
   ###æˆ‘é…ç½®å†™çš„Spooling Directory Source
   spooling-flume-hdfs.conf é…ç½®æ–‡ä»¶å¦‚ä¸‹
   #name
   a1.sources = r1
   a1.sinks = k1
   a1.channels = c1 
   #sources
   a1.sources.r1.type = spooldir
   a1.sources.r1.spoolDir = /home/hdfs/test/spoolDir 
   a1.sources.r1.fileHeader = true
   #sinks
   a1.sinks.k1.type = hdfs
   a1.sinks.k1.hdfs.path =  hdfs://master:8020/flume/events/%Y-%m-%d
   a1.sinks.k1.hdfs.filePrefix = logs-
   a1.sinks.k1.hdfs.round = true
   a1.sinks.k1.hdfs.roundValue = 10
   a1.sinks.k1.hdfs.roundUnit = second
   a1.sinks.k1.hdfs.useLocalTimeStamp = true
   ##channels
   a1.channels.c1.type = memory
   a1.channels.c1.capacity = 10000
   a1.channels.c1.transactionCapacity = 100
   ##bind
   a1.sources.r1.channels = c1
   a1.sinks.k1.channel = c1
   ~~~

   ~~~
   4. å…¥é—¨æ¡ˆä¾‹ 3  å®æ—¶ç›‘æ§ç›®å½•ä¸‹çš„æ–°æ–‡ä»¶,å°†å†…å®¹ä¸Šä¼ åˆ°HDFSä¸­
   é…ç½®æ–‡ä»¶åå­—: spooling-flume-hdfs.conf
   
   #Named
   a1.sources = r1
   a1.channels = c1
   a1.sinks = k1 
   
   #Source
   a1.sources.r1.type = spooldir
   a1.sources.r1.spoolDir = /opt/module/flume-1.9.0/jobs/spooling
   a1.sources.r1.fileSuffix = .COMPLETED
   a1.sources.r1.ignorePattern = .*\.tmp
   
   
   #Channel
   a1.channels.c1.type = memory
   a1.channels.c1.capacity = 10000
   a1.channels.c1.transactionCapacity = 100
   
   #Sink
   a1.sinks.k1.type = hdfs
   a1.sinks.k1.hdfs.path = hdfs://hadoop102:8020/flume/%Y%m%d/%H
   #ä¸Šä¼ æ–‡ä»¶çš„å‰ç¼€
   a1.sinks.k1.hdfs.filePrefix = logs-
   #æ˜¯å¦æŒ‰ç…§æ—¶é—´æ»šåŠ¨æ–‡ä»¶å¤¹
   a1.sinks.k1.hdfs.round = true
   #å¤šå°‘æ—¶é—´å•ä½åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹
   a1.sinks.k1.hdfs.roundValue = 1
   #é‡æ–°å®šä¹‰æ—¶é—´å•ä½
   a1.sinks.k1.hdfs.roundUnit = hour
   #æ˜¯å¦ä½¿ç”¨æœ¬åœ°æ—¶é—´æˆ³
   a1.sinks.k1.hdfs.useLocalTimeStamp = true
   #ç§¯æ”’å¤šå°‘ä¸ªEventæ‰flushåˆ°HDFSä¸€æ¬¡
   a1.sinks.k1.hdfs.batchSize = 100
   #è®¾ç½®æ–‡ä»¶ç±»å‹ï¼Œå¯æ”¯æŒå‹ç¼©
   a1.sinks.k1.hdfs.fileType = DataStream
   #å¤šä¹…ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶
   a1.sinks.k1.hdfs.rollInterval = 60
   #è®¾ç½®æ¯ä¸ªæ–‡ä»¶çš„æ»šåŠ¨å¤§å°
   a1.sinks.k1.hdfs.rollSize = 134217700
   #æ–‡ä»¶çš„æ»šåŠ¨ä¸Eventæ•°é‡æ— å…³
   a1.sinks.k1.hdfs.rollCount = 0
   
   #Bind
   a1.sources.r1.channels = c1 
   a1.sinks.k1.channel = c1 
   ~~~

**ï¼ƒå®æ—¶ç›‘æ§å¤šä¸ªç›®å½•ä¸‹çš„å¤šä¸ªè¿½åŠ æ–‡ä»¶**

Exec sourceé€‚ç”¨äºç›‘æ§ä¸€ä¸ªå®æ—¶è¿½åŠ çš„æ–‡ä»¶ï¼Œä¸èƒ½å®ç°æ–­ç‚¹ç»­ä¼ ï¼›Spooldir Sourceé€‚åˆç”¨äºåŒæ­¥æ–°æ–‡ä»¶ï¼Œä½†ä¸é€‚åˆå¯¹å®æ—¶è¿½åŠ æ—¥å¿—çš„æ–‡ä»¶è¿›è¡Œç›‘å¬å¹¶åŒæ­¥ï¼›è€ŒTaildir Sourceé€‚åˆç”¨äºç›‘å¬å¤šä¸ªå®æ—¶è¿½åŠ çš„æ–‡ä»¶ï¼Œå¹¶ä¸”èƒ½å¤Ÿå®ç°æ–­ç‚¹ç»­ä¼ ã€‚

> æ¡ˆä¾‹éœ€æ±‚:ä½¿ç”¨Flumeç›‘å¬æ•´ä¸ªç›®å½•çš„å®æ—¶è¿½åŠ æ–‡ä»¶ï¼Œå¹¶ä¸Šä¼ è‡³HDFS

- é…ç½®æ–‡ä»¶ç¼–å†™ï¼š

  ~~~
  #name
  a1.sources = r1
  a1.sinks = k1
  a1.channels = c1
  
  #sources
  a1.sources.r1.type = TAILDIR
  a1.sources.r1.positionFile = /home/hdfs/flume/taildir_position.json
  a1.sources.r1.filegroups = f1 f2
  a1.sources.r1.filegroups.f1 = /home/hdfs/test/data/.*\.txt
  a1.sources.r1.filegroups.f2 = /home/hdfs/test/data/.*\.log
  
  #sinks
  a1.sinks.k1.type = hdfs
  a1.sinks.k1.hdfs.path =  hdfs://master:8020/flume/tail/%Y-%m-%d
  a1.sinks.k1.hdfs.filePrefix = tail-
  a1.sinks.k1.hdfs.round = true
  a1.sinks.k1.hdfs.roundValue = 10
  a1.sinks.k1.hdfs.roundUnit = second
  a1.sinks.k1.hdfs.useLocalTimeStamp = true
  
  ##channels
  a1.channels.c1.type = memory
  a1.channels.c1.capacity = 10000
  a1.channels.c1.transactionCapacity = 100
  
  #bind
  a1.sources.r1.channels = c1
  a1.sinks.k1.channel = c1
  ~~~

## ä¸‰ã€Flumeè¿›é˜¶

### 1ã€Flumeäº‹åŠ¡

![](https://s2.loli.net/2024/10/28/mY5EwISqi26ryAW.jpg)

### 2ã€Agentå†…éƒ¨åŸç†

![](https://s2.loli.net/2024/10/28/R3uIcG52YTfvw9W.jpg)

- sourceé‡‡é›†åˆ°æ—¥å¿—æœåŠ¡å™¨æˆ–è€…æ˜¯ç«¯å£ç­‰çš„æ•°æ®æ—¶ï¼ŒæŠ¥æ•°æ®åŒ…è£…æˆevent
- åœ¨æ‰¹é‡çš„æ”¾å…¥ä¸´æ—¶ç¼“å­˜putlistï¼Œå¹¶é€šè¿‡channel processorå¤„ç†äº‹ä»¶
- channel processorå°†äº‹ä»¶ä¼ é€’ç»™æ‹¦æˆªå™¨é“¾ï¼Œå¯¹äº‹ä»¶è¿›è¡Œè¿‡æ»¤
- å†æŠŠäº‹ä»¶è¿˜å›channel processorå¹¶å°†æ¯ä¸ªäº‹ä»¶ç»™channel selector
- è¿”å›å†™å…¥äº‹ä»¶çš„channel åˆ—è¡¨
- æ ¹æ®channelé€‰æ‹©å™¨çš„ç»“æœï¼Œå°†äº‹ä»¶å†™å…¥å¯¹åº”å¾—channelä¸­
- doTakeå°†äº‹ä»¶æ‰¹é‡çš„å–åˆ°sink processorä¸­å†é€šè¿‡äº‹åŠ¡å†™å…¥åˆ°ç›¸åº”çš„ç›®æ ‡ä¸­

1. ChannelSelector

   ChannelSelectorçš„ä½œç”¨å°±æ˜¯é€‰å‡ºEventå°†è¦è¢«å‘å¾€å“ªä¸ªChannelã€‚å…¶å…±æœ‰ä¸¤ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯Replicatingï¼ˆå¤åˆ¶ï¼‰å’ŒMultiplexingï¼ˆå¤šè·¯å¤ç”¨ï¼‰ã€‚

   ReplicatingSelectorä¼šå°†åŒä¸€ä¸ªEventå‘å¾€æ‰€æœ‰çš„Channelï¼ŒMultiplexingä¼šæ ¹æ®ç›¸åº”çš„åŸåˆ™ï¼Œå°†ä¸åŒçš„Eventå‘å¾€ä¸åŒçš„Channelã€‚

2. SinkProcessor

   SinkProcessorå…±æœ‰ä¸‰ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯DefaultSinkProcessorã€LoadBalancingSinkProcessorå’ŒFailoverSinkProcessor

   DefaultSinkProcessorå¯¹åº”çš„æ˜¯å•ä¸ªçš„Sinkï¼ŒLoadBalancingSinkProcessorå’ŒFailoverSinkProcessorå¯¹åº”çš„æ˜¯Sink Groupï¼ŒLoadBalancingSinkProcessorå¯ä»¥å®ç°è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼ŒFailoverSinkProcessorå¯ä»¥é”™è¯¯æ¢å¤çš„åŠŸèƒ½ã€‚

### 3ã€Flumeçš„æ‹“æ‰‘ç»“æ„

1. ç®€å•ä¸²è”ï¼šè¿™ç§æ¨¡å¼æ˜¯å°†å¤šä¸ªflumeé¡ºåºè¿æ¥èµ·æ¥äº†ï¼Œä»æœ€åˆçš„sourceå¼€å§‹åˆ°æœ€ç»ˆsinkä¼ é€çš„ç›®çš„å­˜å‚¨ç³»ç»Ÿã€‚æ­¤æ¨¡å¼ä¸å»ºè®®æ¡¥æ¥è¿‡å¤šçš„flumeæ•°é‡ï¼Œ flumeæ•°é‡è¿‡å¤šä¸ä»…ä¼šå½±å“ä¼ è¾“é€Ÿç‡ï¼Œè€Œä¸”ä¸€æ—¦ä¼ è¾“è¿‡ç¨‹ä¸­æŸä¸ªèŠ‚ç‚¹flumeå®•æœºï¼Œä¼šå½±å“æ•´ä¸ªä¼ è¾“ç³»ç»Ÿã€‚

   å³ï¼Œä¸€ä¸ªagentçš„sinkè¿æ¥å¦ä¸ªagentçš„source

2. å¤åˆ¶å’Œå¤šè™‘å¤ç”¨ï¼šFlumeæ”¯æŒå°†äº‹ä»¶æµå‘ä¸€ä¸ªæˆ–è€…å¤šä¸ªç›®çš„åœ°ã€‚è¿™ç§æ¨¡å¼å¯ä»¥å°†ç›¸åŒæ•°æ®å¤åˆ¶åˆ°å¤šä¸ªchannelä¸­ï¼Œæˆ–è€…å°†ä¸åŒæ•°æ®åˆ†å‘åˆ°ä¸åŒçš„channelä¸­ï¼Œsinkå¯ä»¥é€‰æ‹©ä¼ é€åˆ°ä¸åŒçš„ç›®çš„åœ°ã€‚

3. è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ï¼šFlumeæ”¯æŒä½¿ç”¨å°†å¤šä¸ªsinké€»è¾‘ä¸Šåˆ†åˆ°ä¸€ä¸ªsinkç»„ï¼Œsinkç»„é…åˆä¸åŒçš„SinkProcessorå¯ä»¥å®ç°è´Ÿè½½å‡è¡¡å’Œé”™è¯¯æ¢å¤çš„åŠŸèƒ½ã€‚

4. èšåˆï¼š

   è¿™ç§æ¨¡å¼æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„ï¼Œä¹Ÿéå¸¸å®ç”¨ï¼Œæ—¥å¸¸webåº”ç”¨é€šå¸¸åˆ†å¸ƒåœ¨ä¸Šç™¾ä¸ªæœåŠ¡å™¨ï¼Œå¤§è€…ç”šè‡³ä¸Šåƒä¸ªã€ä¸Šä¸‡ä¸ªæœåŠ¡å™¨ã€‚äº§ç”Ÿçš„æ—¥å¿—ï¼Œå¤„ç†èµ·æ¥ä¹Ÿéå¸¸éº»çƒ¦ã€‚ç”¨flumeçš„è¿™ç§ç»„åˆæ–¹å¼èƒ½å¾ˆå¥½çš„è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæ¯å°æœåŠ¡å™¨éƒ¨ç½²ä¸€ä¸ªflumeé‡‡é›†æ—¥å¿—ï¼Œä¼ é€åˆ°ä¸€ä¸ªé›†ä¸­æ”¶é›†æ—¥å¿—çš„flumeï¼Œå†ç”±æ­¤flumeä¸Šä¼ åˆ°hdfsã€hiveã€hbaseç­‰ï¼Œè¿›è¡Œæ—¥å¿—åˆ†æã€‚

### 4ã€Flumeå¼€å‘æ¡ˆä¾‹

>æ¡ˆä¾‹éœ€æ±‚ï¼šä½¿ç”¨Flume-1ç›‘æ§æ–‡ä»¶å˜åŠ¨ï¼ŒFlume-1å°†å˜åŠ¨å†…å®¹ä¼ é€’ç»™Flume-2ï¼ŒFlume-2è´Ÿè´£å­˜å‚¨åˆ°HDFSã€‚åŒæ—¶Flume-1å°†å˜åŠ¨å†…å®¹ä¼ é€’ç»™Flume-3ï¼ŒFlume-3è´Ÿè´£è¾“å‡ºåˆ°Local FileSystemã€‚

- é…ç½®æ–‡ä»¶ç¼–å†™ï¼š

  ~~~
  Flume-1
  #name
  a1.sources = r1
  a1.sinks = k1 k2
  a1.channels = c1 c2
  
  #sources
  a1.sources.r1.type = TAILDIR
  a1.sources.r1.positionFile = /home/hdfs/flume/taildir_position.json
  a1.sources.r1.filegroups = f1
  a1.sources.r1.filegroups.f1 = /home/hdfs/test/data/log.log
  
  a1.sources.r1.selector.type = replicating
  
  ##sinks
  a1.sinks.k1.type = avro
  a1.sinks.k1.hostname = 192.168.157.10
  a1.sinks.k1.port = 6666
  
  a1.sinks.k2.type = avro
  a1.sinks.k2.hostname = 192.168.157.10
  a1.sinks.k2.port = 7777
  
  ##channels
  a1.channels.c1.type = memory
  a1.channels.c1.capacity = 10000
  a1.channels.c1.transactionCapacity = 100
  
  a1.channels.c2.type = memory
  a1.channels.c2.capacity = 10000
  a1.channels.c2.transactionCapacity = 100
  
  ##bind
  a1.sources.r1.channels = c1
  a1.sinks.k1.channel = c1
  
  a1.sources.r1.channels = c2
  a1.sinks.k2.channel = c2
  
  flume-ng agent -c $FLUME_HOME/conf -n a1 -f ~/confs/flume-01.conf -Dflume.root.logger=INFO,console
  #############################################################################################
  Flume-2
  #name
  a2.sources = r2
  a2.sinks = k2
  a2.channels = c2
  
  #sources
  a2.sources.r2.type = avro
  a2.sources.r2.bind = localhost
  a2.sources.r2.port = 6666
  
  ##sinks
  a2.sinks.k2.type = hdfs
  a2.sinks.k2.hdfs.path =  hdfs://master:8020/flume/threeflume/%Y-%m-%d
  a2.sinks.k2.hdfs.filePrefix = log-
  a2.sinks.k2.hdfs.round = true
  a2.sinks.k2.hdfs.roundValue = 10
  a2.sinks.k2.hdfs.roundUnit = second
  a2.sinks.k2.hdfs.useLocalTimeStamp = true
  
  ##channels
  a2.channels.c2.type = memory
  a2.channels.c2.capacity = 10000
  a2.channels.c2.transactionCapacity = 100
  
  ##bind
  a2.sources.r2.channels = c2
  a2.sinks.k2.channel = c2
  
  flume-ng agent -c $FLUME_HOME/conf -n a2 -f ~/confs/flume-02.conf -Dflume.root.logger=INFO,console
  ################################################################################################
  Flume-3
  #name
  a3.sources = r3
  a3.sinks = k3
  a3.channels = c3
  
  #sources
  a3.sources.r3.type = avro
  a3.sources.r3.bind = localhost
  a3.sources.r3.port = 7777
  
  ##sinks
  a3.sinks.k3.type = file_roll   ##é‡‡é›†åˆ°çš„æ•°æ®æ”¾åˆ°æœ¬åœ°Stores events on the local filesystem. 
  a3.sinks.k3.sink.directory = /opt/module/flume-1.9.0/jobs/fileroll
  
  ##channels
  a3.channels.c3.type = memory
  a3.channels.c3.capacity = 10000
  a3.channels.c3.transactionCapacity = 100
  
  ##bind
  a3.sources.r3.channels = c3
  a3.sinks.k3.channel = c3
  
  flume-ng agent -c $FLUME_HOME/conf -n a3 -f ~/confs/flume-03.conf -Dflume.root.logger=INFO,console
  ~~~

- è¾“å‡ºçš„æœ¬åœ°ç›®å½•å¿…é¡»æ˜¯å·²ç»å­˜åœ¨çš„ç›®å½•ï¼Œå¦‚æœè¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œå¹¶ä¸ä¼šåˆ›å»ºæ–°çš„ç›®å½•ã€‚

**#è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»**

- ##### æ•…éšœè½¬ç§»ï¼šæ¡ˆä¾‹åˆ†æ

ä½¿ç”¨Flume1ç›‘æ§ä¸€ä¸ªç«¯å£ï¼Œå…¶sinkç»„ä¸­çš„sinkåˆ†åˆ«å¯¹æ¥Flume2å’ŒFlume3ï¼Œé‡‡ç”¨FailoverSinkProcessorï¼Œå®ç°æ•…éšœè½¬ç§»çš„åŠŸèƒ½ã€‚

**ä½¿ç”¨jps -mlæŸ¥çœ‹Flumeè¿›ç¨‹ã€‚**

~~~
flume01-failover.conf

#name
a1.sources = r1
a1.sinkgroups = g1
a1.sinks = k1 k2
a1.channels = c1


#sources
a1.sources.r1.type = netcat
a1.sources.r1.bind = localhost
a1.sources.r1.port = 44444



a1.sinkgroups.g1.processor.type = failover
a1.sinkgroups.g1.processor.priority.k1 = 5
a1.sinkgroups.g1.processor.priority.k2 = 10
a1.sinkgroups.g1.processor.maxpenalty = 10000

##sinks
a1.sinks.k1.type = avro
a1.sinks.k1.hostname = localhost
a1.sinks.k1.port = 6666

a1.sinks.k2.type = avro
a1.sinks.k2.hostname = localhost
a1.sinks.k2.port = 7777

##channels
a1.channels.c1.type = memory
a1.channels.c1.capacity = 10000
a1.channels.c1.transactionCapacity = 100


##bind
a1.sinkgroups.g1.sinks = k1 k2
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
a1.sinks.k2.channel = c1

flume-ng agent -c $FLUME_HOME/conf -n a1 -f ~/confs/flume01-failover.conf -Dflume.root.logger=INFO,console
################################################################################################
flume02-failover.conf
#name
a2.sources = r2
a2.sinks = k2
a2.channels = c2

#sources
a2.sources.r2.type = avro
a2.sources.r2.bind = localhost
a2.sources.r2.port = 6666

##sinks
a2.sinks.k2.type = logger

##channels
a2.channels.c2.type = memory
a2.channels.c2.capacity = 10000
a2.channels.c2.transactionCapacity = 100

##bind
a2.sources.r2.channels = c2
a2.sinks.k2.channel = c2

flume-ng agent -c $FLUME_HOME/conf -n a2 -f ~/confs/flume02-failover.conf -Dflume.root.logger=INFO,console

################################################################################################

flume03-failover.conf
#name
a3.sources = r3
a3.sinks = k3
a3.channels = c3

#sources
a3.sources.r3.type = avro
a3.sources.r3.bind = localhost
a3.sources.r3.port = 7777

##sinks
a3.sinks.k3.type = logger

##channels
a3.channels.c3.type = memory
a3.channels.c3.capacity = 10000
a3.channels.c3.transactionCapacity = 100

##bind
a3.sources.r3.channels = c3
a3.sinks.k3.channel = c3

flume-ng agent -c $FLUME_HOME/conf -n a3 -f ~/confs/flume03-failover.conf -Dflume.root.logger=INFO,console
~~~

- è´Ÿè½½å‡è¡¡


~~~txt
flume01-balance.conf

#name
a1.sources = r1
a1.sinks = k1 k2
a1.channels = c1


#sources
a1.sources.r1.type = netcat
a1.sources.r1.bind = localhost
a1.sources.r1.port = 44444



a1.sinkgroups.g1.processor.type = load_balance
a1.sinkgroups.g1.processor.backoff = true
a1.sinkgroups.g1.processor.selector = random

##sinks
a1.sinks.k1.type = avro
a1.sinks.k1.hostname = localhost
a1.sinks.k1.port = 6666

a1.sinks.k2.type = avro
a1.sinks.k2.hostname = localhost
a1.sinks.k2.port = 7777

##channels
a1.channels.c1.type = memory
a1.channels.c1.capacity = 10000
a1.channels.c1.transactionCapacity = 100


##bind
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
a1.sinks.k2.channel = c1

flume-ng agent -c $FLUME_HOME/conf -n a1 -f ~/confs/flume01-balance.conf -Dflume.root.logger=INFO,console

################################################################################################

flume02-balance.conf
#name
a2.sources = r2
a2.sinks = k2
a2.channels = c2

#sources
a2.sources.r2.type = avro
a2.sources.r2.bind = localhost
a2.sources.r2.port = 6666

##sinks
a2.sinks.k2.type = logger

##channels
a2.channels.c2.type = memory
a2.channels.c2.capacity = 10000
a2.channels.c2.transactionCapacity = 100

##bind
a2.sources.r2.channels = c2
a2.sinks.k2.channel = c2

flume-ng agent -c $FLUME_HOME/conf -n a2 -f ~/confs/flume02-balance.conf -Dflume.root.logger=INFO,console

################################################################################################


flume03-balance.conf
#name
a3.sources = r3
a3.sinks = k3
a3.channels = c3

#sources
a3.sources.r3.type = avro
a3.sources.r3.bind = localhost
a3.sources.r3.port = 7777

##sinks
a3.sinks.k3.type = logger

##channels
a3.channels.c3.type = memory
a3.channels.c3.capacity = 10000
a3.channels.c3.transactionCapacity = 100

##bind
a3.sources.r3.channels = c3
a3.sinks.k3.channel = c3

flume-ng agent -c $FLUME_HOME/conf -n a3 -f ~/confs/flume03-balance.conf -Dflume.root.logger=INFO,console
~~~

- èšåˆ


>æ¡ˆä¾‹éœ€æ±‚ï¼šhadoop102ä¸Šçš„Flume-1ç›‘æ§æ–‡ä»¶/opt/module/group.logï¼Œhadoop103ä¸Šçš„Flume-2ç›‘æ§æŸä¸€ä¸ªç«¯å£çš„æ•°æ®æµï¼ŒFlume-1ä¸Flume-2å°†æ•°æ®å‘é€ç»™hadoop104ä¸Šçš„Flume-3ï¼ŒFlume-3å°†æœ€ç»ˆæ•°æ®æ‰“å°åˆ°æ§åˆ¶å°ã€‚

~~~
flume01-aggre.conf

#name
a1.sources = r1
a1.sinks = k1
a1.channels = c1

#sources
a1.sources.r1.type = TAILDIR
a1.sources.r1.positionFile = /home/hdfs/flume/taildir_position.json
a1.sources.r1.filegroups = f1
a1.sources.r1.filegroups.f1 = /home/hdfs/test/data/log.log

a1.sources.r1.selector.type = replicating

##sinks
a1.sinks.k1.type = avro
a1.sinks.k1.hostname = slave-02
a1.sinks.k1.port = 6666

##channels
a1.channels.c1.type = memory
a1.channels.c1.capacity = 10000
a1.channels.c1.transactionCapacity = 100

##bind
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1


flume-ng agent -c $FLUME_HOME/conf -n a1 -f ~/confs/flume01-aggre.conf -Dflume.root.logger=INFO,console

###############################################################################################

flume02-aggre.conf

#name
a1.sources = r1
a1.sinks = k1
a1.channels = c1


#sources
a1.sources.r1.type = netcat
a1.sources.r1.bind = localhost
a1.sources.r1.port = 44444

##sinks
a1.sinks.k1.type = avro
a1.sinks.k1.hostname = slave-02
a1.sinks.k1.port = 6666


##channels
a1.channels.c1.type = memory
a1.channels.c1.capacity = 10000
a1.channels.c1.transactionCapacity = 100


##bind
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1

flume-ng agent -c $FLUME_HOME/conf -n a1 -f ~/confs/flume02-aggre.conf -Dflume.root.logger=INFO,console

################################################################################################


flume03-aggre.conf
#name
a2.sources = r2
a2.sinks = k2
a2.channels = c2

#sources
a2.sources.r2.type = avro
a2.sources.r2.bind = slave-02  ##æ­¤å¤„ä¸èƒ½å†™localhost
a2.sources.r2.port = 6666

##sinks
a2.sinks.k2.type = logger

##channels
a2.channels.c2.type = memory
a2.channels.c2.capacity = 10000
a2.channels.c2.transactionCapacity = 100

##bind
a2.sources.r2.channels = c2
a2.sinks.k2.channel = c2

flume-ng agent -c $FLUME_HOME/conf -n a2 -f ~/confs/flume03-aggre.conf -Dflume.root.logger=INFO,console


~~~

- è‡ªå®šä¹‰interceptor


>éœ€æ±‚ï¼šä½¿ç”¨Flumeé‡‡é›†æœåŠ¡å™¨æœ¬åœ°æ—¥å¿—ï¼Œéœ€è¦æŒ‰ç…§æ—¥å¿—ç±»å‹çš„ä¸åŒï¼Œå°†ä¸åŒç§ç±»çš„æ—¥å¿—å‘å¾€ä¸åŒçš„åˆ†æç³»ç»Ÿã€‚

1. æ·»åŠ mavenä¾èµ–

   ~~~xml
    <dependencies>
           <dependency>
               <groupId>org.apache.flume</groupId>
               <artifactId>flume-ng-core</artifactId>
               <version>1.9.0</version>
           </dependency>
    </dependencies>
   ~~~

2. ç¼–å†™interceptor

   ~~~java
   public class MyInterceptor  implements Interceptor {
       @Override
       public void initialize() { }
       @Override
       public Event intercept(Event event) {
           byte[] body = event.getBody();
           String s = new String(body, StandardCharsets.UTF_8);
           if (s.contains("#") || s.contains("*")) {
               event.getHeaders().put("type","char");
           }else if (s.contains("1")){
               event.getHeaders().put("type","num");
           }else {
               event.getHeaders().put("type","word");
           }
           return event;
       }
       @Override
       public List<Event> intercept(List<Event> list) {
           for (Event event : list) {
               intercept(event);
           }
           return list;
       }
       @Override
       public void close() { }
       public static class build implements Interceptor.Builder{
           @Override
           public Interceptor build() {
               return new MyInterceptor();
           }
           @Override
           public void configure(Context context) { }
       }
   }
   ~~~

3. ç¼–å†™flumeé…ç½®æ–‡ä»¶

   ~~~
   flume01-interceptor.conf
   
   #name
   a1.sources = r1
   a1.sinks = k1 k2 k3
   a1.channels = c1 c2 c3
   
   
   #sources
   a1.sources.r1.type = netcat
   a1.sources.r1.bind = localhost
   a1.sources.r1.port = 44444
   a1.sources.r1.interceptors = i1
   a1.sources.r1.interceptors.i1.type = com.suhe.interceptor.MyInterceptor$Builder
   a1.sources.r1.selector.type = multiplexing
   a1.sources.r1.selector.header = type
   a1.sources.r1.selector.mapping.char = c1
   a1.sources.r1.selector.mapping.num = c2
   a1.sources.r1.selector.mapping.word = c3
   
   ##sinks
   a1.sinks.k1.type = avro
   a1.sinks.k1.hostname = localhost
   a1.sinks.k1.port = 6666
   
   a1.sinks.k2.type = avro
   a1.sinks.k2.hostname = localhost
   a1.sinks.k2.port = 7777
   
   a1.sinks.k3.type = avro
   a1.sinks.k3.hostname = localhost
   a1.sinks.k3.port = 8888
   
   
   
   ##channels
   a1.channels.c1.type = memory
   a1.channels.c1.capacity = 10000
   a1.channels.c1.transactionCapacity = 100
   
   a1.channels.c2.type = memory
   a1.channels.c2.capacity = 10000
   a1.channels.c2.transactionCapacity = 100
   
   a1.channels.c3.type = memory
   a1.channels.c3.capacity = 10000
   a1.channels.c3.transactionCapacity = 100
   
   ##bind
   a1.sources.r1.channels = c1 c2 c3
   a1.sinks.k1.channel = c1
   a1.sinks.k2.channel = c2
   a1.sinks.k3.channel = c3
   
   flume-ng agent -c $FLUME_HOME/conf -n a1 -f ~/confs/flume01-interceptor.conf -Dflume.root.logger=INFO,console
   #############################################################################################
   
   
   
   flume02-interceptor.conf
   #name
   a1.sources = r1
   a1.sinks = k1
   a1.channels = c1
   
   #sources
   a1.sources.r1.type = avro
   a1.sources.r1.bind = localhost
   a1.sources.r1.port = 6666
   
   ##sinks
   a1.sinks.k1.type = logger
   
   ##channels
   a1.channels.c1.type = memory
   a1.channels.c1.capacity = 10000
   a1.channels.c1.transactionCapacity = 100
   
   ##bind
   a1.sources.r1.channels = c1
   a1.sinks.k1.channel = c1
   
   flume-ng agent -c $FLUME_HOME/conf -n a1 -f ~/confs/flume02-interceptor.conf -Dflume.root.logger=INFO,console
   
   
   #############################################################################################
   
   flume03-interceptor.conf
   #name
   a1.sources = r1
   a1.sinks = k1
   a1.channels = c1
   
   #sources
   a1.sources.r1.type = avro
   a1.sources.r1.bind = localhost
   a1.sources.r1.port = 7777
   
   ##sinks
   a1.sinks.k1.type = logger
   
   ##channels
   a1.channels.c1.type = memory
   a1.channels.c1.capacity = 10000
   a1.channels.c1.transactionCapacity = 100
   
   ##bind
   a1.sources.r1.channels = c1
   a1.sinks.k1.channel = c1
   
   flume-ng agent -c $FLUME_HOME/conf -n a1 -f ~/confs/flume03-interceptor.conf -Dflume.root.logger=INFO,console
   
   #############################################################################################
   
   flume04-interceptor.conf
   
   #name
   a1.sources = r1
   a1.sinks = k1
   a1.channels = c1
   
   #sources
   a1.sources.r1.type = avro
   a1.sources.r1.bind = localhost
   a1.sources.r1.port = 8888
   
   ##sinks
   a1.sinks.k1.type = logger
   
   ##channels
   a1.channels.c1.type = memory
   a1.channels.c1.capacity = 10000
   a1.channels.c1.transactionCapacity = 100
   
   ##bind
   a1.sources.r1.channels = c1
   a1.sinks.k1.channel = c1
   
   flume-ng agent -c $FLUME_HOME/conf -n a1 -f ~/confs/flume04-interceptor.conf -Dflume.root.logger=INFO,console
   ~~~

   ~~~
   #name
   a1.sources = r1
   a1.channels = c1
   #sources
   a1.sources.r1.type = TAILDIR
   a1.sources.r1.positionFile = /home/suxichuan/flume/taildir_position.json
   a1.sources.r1.filegroups = f1
   a1.sources.r1.filegroups.f1 = /home/suxichuan/behavior/log
   #channels
   a1.channels.channel1.type = org.apache.flume.channel.kafka.KafkaChannel
   a1.channels.channel1.kafka.bootstrap.servers = hadoop102:9092,hadoop103:9092,hadoop104:9092
   a1.channels.channel1.kafka.topic = ods_behavor_log
   a1.channels.channel1.kafka.consumer.group.id = ods_behavor_group_1		
   ~~~

ä»¥ä¸Šå°±æ˜¯ï¼ŒFlumeåŸºç¡€å­¦ä¹ å†…å®¹ï¼Œåç»­ä¼šæ ¹æ®å­¦ä¹ çš„è§„åˆ’è°ƒæ•´ç¬”è®°æ›´æ–°çš„å†…å®¹ã€‚





